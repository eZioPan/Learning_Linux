= SQLite 笔记

== 特点

SQLite 是轻量化的数据库，它的最大的特点就是 serverless，也就是说，它不像 PostgreSQL 和 MongoDB 一样，在使用前需要安装和配置对应的服务器。

这样它就可以方便地作为一个软件内置的数据库而存在。

== 安装

link:https://www.sqlite.org/download.html[]

其中 `sqlite_tool` 的包，是 SQLite 官方提供的数据操纵命令行工具

== 语法

这里我们说的语法，既包含通用的 SQL 语法，又包含命令行工具 `sqlite3` 所特有的语法。

对于命令行工具特有的语法，我们使用“命令（command）”来表述 +
对于通用的 SQL 语法，我们使用“语句（statement）”来表述。

=== 常见的 sqlite3 命令（command）

[cols="^.^1m,^.^2,2a"]
.打开、关闭、读取、写入
|===
| sqlite3 命令 | 含义 | 备注

| .help
| 打印所有**命令**的简短帮助
|

| .quit
| 关闭 `sqlite3.exe` 交互
|

| .open <数据库文件>
| 将一个数据库作为 main 数据库打开
| 等价于在命令行中运行 +
`sqilte3.exe <数据库文件>` +
注意，以这种方式打开的数据库，不可以被 `DETACH DATABASE` 关闭

d| `.backup [数据库名] <保存路径>` +
以及 +
`.save [数据库名] <保存路径>`
| 将指定的数据库保存为一个数据库文件
| 若不指定数据库名，则将 main 保存至指定文件

| .read <FILE>
| 从文件读取命令或语句，并执行
|
|===


[cols="^.^1m,^.^2,2a"]
.枚举相关的命令
|===
| sqlite3 命令 | 含义 | 备注

| .databases
| 显示当前打开的/连接的数据库
| 会显示数据库的名称、文件名、以及读写权限
[TIP]
====
在使用 `ATTACH DATABASE` 语句之后会很有用
====

| .tables [表名]
| 罗列匹配上的表的名称
| 若不指定表名，则罗列全部的表
[source, sqlite3]
.罗列以 es 作为表名结尾的表
----
.table "%es"
----

| .schema [表名]
| 罗列匹配上的表的架构
| 返回值均以 `CREATE` 开头，模拟了创建表的流程

| .fullschema
| 罗列全部的表架构，包含特殊的表 sqlite_stat
|

| .indexes [表名]
| 显示特定表的索引
| 若不指定表名，则显示全部的索引
[source, sqlite3]
.罗列以 es 作为表名结尾的索引
----
.indexes "%es"
----
|===

[cols="^.^1m,^.^2,2a"]
.修改输出模式
|===
| sqlite3 命令 | 含义 | 备注

| .mode [显示模式]
| 设置输出的显示模式
| 没有参数时，输出当前的显示模式 +
要获得所有支持的模式，可以随便用一个字符当参数，看看输出的报错即可

| .header <on\|off>
| 打开或关闭表头的显示
|
|===

[cols="^.^1m,^.^2,2a"]
.输出重定向
|===
| sqlite3 命令 | 含义 | 备注

| .output [文件名]
| 修改输出的位置
| 默认为 stdout，如果设置为文件，则将输出写入指定的文件中。 +
**使用不带参数的 `.output` 可以将输出重新导向至 stdout**

| .once [文件名]
| 修改下一条 sqlite3 命令/ SQL 语句 的输出位置
|
|===

=== 常见的 SQL 的语句（statement）

[cols="^.^1m,^.^2,2a"]
.常见的 SQL 的语句（statement）
|===
| SQL 语句 | 含义 | 备注

3+d| **一个完整的 SQL 语句必须以分号 `;` 结尾**

| ATTACH DATABASE "<数据库文件>" AS <名称>
| 在同一个 sqlite3 会话中再打开一个数据库
| 特别注意 **数据库文件名必须使用引号包裹** +
`AS` 后跟随的 <名称>，是当前 sqlite3 会话中该数据库的代指。

| DETACH DATABASE <数据库文件>
| 关闭一个已经打开的数据库
|===
